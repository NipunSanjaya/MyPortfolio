<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Item Manage</title>
    <meta content="width=device-width initial-scale=1" name="viewport">
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/css/styles.css" rel="stylesheet">
    <link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
          integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" rel="stylesheet">
    <style>
        ul > li {
            cursor: pointer;
        }
    </style>
</head>
<body>
<!--header-->
<header class="jumbotron bg-primary text-white p-3">
    <h1 class="position-absolute" id="nav"></h1>
    <ul class="list-group list-group-horizontal text-danger justify-content-end font-weight-bold">
        <li class="list-group-item bg-white" id="lnkHome"><a href="../index.html">Home</a></li>
        <li class="list-group-item bg-white" id="lnkCustomer"><a href="customer.html">Customer</a></li>
        <li class="list-group-item bg-danger text-white" id="lnkItem"><a class="text-white" href="item.html">Item</a></li>
        <li class="list-group-item bg-white" id="lnkOrders"><a href="purchase-order.html">Orders</a></li>
    </ul>
</header>

<!--item content-->
<main class="container-fluid" id="itemContent">
    <section class="row">
        <div class="col-12 col-lg-4">
            <h1>Item Form</h1>

            <div class="form-group">
                <label for="itemCode">Item Code</label>
                <input class="form-control" id="itemCode" type="text">
                <span class="control-error" id="lblCode"></span>
            </div>
            <div class="form-group">
                <label for="itemName">Item Name</label>
                <input class="form-control" id="itemName" type="text">
                <span class="control-error" id="lblname"></span>
            </div>
            <div class="form-group">
                <label for="itemQty">Item Qty</label>
                <input class="form-control" id="itemQty" type="text">
                <span class="control-error" id="lblqty"></span>
            </div>
            <div class="form-group">
                <label for="itemPrice">Unit Price</label>
                <input class="form-control" id="itemPrice" type="text">
                <span class="control-error" id="lblprice"></span>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" id="btnItem">Add Item</button>
                <button class="btn btn-danger" id="btnItemDelete">Remove</button>
                <button class="btn btn-warning" id="btnItemUpdate">Update</button>
                <button class="btn btn-success" id="btnGetAll">Get All</button>
                <button class="btn btn-danger" id="btn-clear">Clear All</button>
            </div>

        </div>
        <div class="col-12 col-lg-8 mt-3">
            <table class="table table-bordered table-hover" id="tableItem">
                <thead class="bg-danger text-white">
                <tr>
                    <th>Item Code</th>
                    <th>Item Name</th>
                    <th>Item Qty</th>
                    <th>Item Price</th>
                </tr>
                </thead>
                <tbody id="tblItem">

                </tbody>
            </table>
        </div>
    </section>

</main>
<script src="../assets/js/jquery-3.7.0.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function() {

        let itemData = [];

        var $itemCode = $('#itemCode');
        var $itemName = $('#itemName');
        var $itemQty = $('#itemQty');
        var $itemPrice = $('#itemPrice');
        var $tblItem = $('#tblItem');

        // $('#itemCode','#itemName','#itemQty','#itemPrice').keyDown(function (e) {
        //     if (e.key == "Tab") { // Tab key
        //         e.preventDefault();
        //     }
        // });
        //
        $("#itemCode").keydown(function (e) {
            if (e.key =="Enter"){

                if (validation1()){
                    $("#itemName").focus();
                }else {
                    alert("Invalid Item code format");
                }

            }
        })

        function validation1() {
            var codeValidation = /^C00-(0\d{2}|[1-9]\d{2})$/;
            codeValidation.test($itemCode.val());
            //let b = codeValidation.test("$itemCode");
            if (codeValidation.test($itemCode.val())){
                //alert("Item code is done");
            }else {
                alert("Invalid Item code format");
            }

        }
        function validation2() {
            var nameValidation =/^[A-Z],[a-z]$/ ;
            //let b = codeValidation.test("$itemCode");
            if (nameValidation.test($itemName.val())){
            }else {
                alert("Invalid Item name format");
            }
        }



        $('#btnItem').click(function() {
            // Add item logic
            var code = $itemCode.val();
            var name = $itemName.val();
            var qty = $itemQty.val();
            var price = $itemPrice.val();

            let item = {
                code: code,
                name: name,
                qty: qty,
                price: price
            };
            //validation1();
            itemData.push(item);

            updateTable();
            $itemCode.focus();
            clearText();
            // $itemCode.val('');
            // $itemName.val('');
            // $itemQty.val('');
            // $itemPrice.val('');

        });
        function clearText() {
            $itemCode.val('');
            $itemName.val('');
            $itemQty.val('');
            $itemPrice.val('');
        }

        function updateTable() {
            let tBody = $tblItem;
            tBody.empty();
            $.each(itemData, function(index, item) {
                let row = $('<tr></tr>');
                $('<td></td>').text(item.code).appendTo(row);
                $('<td></td>').text(item.name).appendTo(row);
                $('<td></td>').text(item.qty).appendTo(row);
                $('<td></td>').text(item.price).appendTo(row);
                row.appendTo(tBody);
            });
            EventBinding();
            clearText();
        }


        $('#btnItemDelete').click(function() {

            var code = $itemCode.val();
            deleteItem(code);
            updateTable();

        });

        function deleteItem (code) {
            for (let i = 0; i < itemData.length; i++) {
                if (itemData[i].code == code){
                    itemData.splice(i, 1);
                    return true;
                }
            }

        }
        function updateItem (code) {
            for (let i = 0; i < itemData.length; i++) {
                if (itemData[i].code == code){
                    // itemData.splice(i, 1);
                    var updatedItem = {
                        code: $itemCode.val(),
                        name: $itemName.val(),
                        qty: $itemQty.val(),
                        price: $itemPrice.val()
                    };
                    itemData[i] = updatedItem;
                    updateTable();
                    clearText();
                    $itemCode.focus();
                    return true;
                }
            }

        }


        // $('#btnItemUpdate').click(function() {
        //     console.log(alert("hi"))
        // });

        $('#btnItemUpdate').click(function() {
            // Update selected item in the table
            // if(searchItem(code)==undefined){
            //     alert("No search Item");
            // }else {
            //     let consent = confirm("do you really went to update item ?");
            //     if (consent){
            //         var code = $itemCode.val();
            //
            //     }
            // }
            var code = $itemCode.val();
            updateItem(code);

        });

        $('#btn-clear').click(function clear() {
            updateTable();
            $itemCode.val('');
            $itemName.val('');
            $itemQty.val('');
            $itemPrice.val('');
            $itemCode.focus();
        });
        $('#btnGetAll').click( function() {
            updateTable();
            $itemCode.focus();
        });


        function EventBinding (){
            $('#tblItem>tr').click( function() {

                var selectedRow = $(this);
                var code = selectedRow.children().eq(0).text();
                var name = selectedRow.children().eq(1).text();
                var qty = selectedRow.children().eq(2).text();
                var price = selectedRow.children().eq(3).text();

                console.log(code);

                $itemCode.val(code);
                $itemName.val(name);
                $itemQty.val(qty);
                $itemPrice.val(price);
                $itemCode.focus();
            });
        }

        // $('#txtItemCode').onkeypress(function (){
        //     var code = $itemCode.val();
        //     return itemData.find(function (item) {
        //         return itemData.code == item;
        //     })
        // });
        // function searchItem(code) {
        //     return itemData.find(function (item) {
        //         return itemData.code == item;
        //     })
        // }
    });

</script>

</body>
</html>